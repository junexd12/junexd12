-- Player-Only NoClip Script for Roblox
-- Allows your character to move through walls while blocks remain solid
-- Press Z to toggle NoClip mode

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Configuration
local NoClipEnabled = false
local ToggleKey = Enum.KeyCode.Z
local EffectColor = Color3.fromRGB(0, 170, 255)
local NoClipConnection = nil

-- Function to enable NoClip
local function enableNoClip()
    if NoClipConnection then return end
    
    -- Create visual effect to show NoClip is active
    local effect = Instance.new("Highlight")
    effect.Name = "NoClipEffect"
    effect.FillColor = EffectColor
    effect.OutlineColor = Color3.fromRGB(255, 255, 255)
    effect.FillTransparency = 0.7
    effect.OutlineTransparency = 0.5
    effect.Parent = Character
    
    -- Connect the NoClip function to RunService.Stepped
    NoClipConnection = RunService.Stepped:Connect(function()
        if Character and Character.Parent then
            for _, part in pairs(Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
    
    -- Optional: Make character slightly transparent to indicate NoClip mode
    for _, part in pairs(Character:GetDescendants()) do
        if part:IsA("BasePart") and part.Transparency < 0.5 then
            part.Transparency = part.Transparency + 0.3
        end
    end
    
    NoClipEnabled = true
    print("NoClip Enabled - You can now move through walls!")
end

-- Function to disable NoClip
local function disableNoClip()
    if NoClipConnection then
        NoClipConnection:Disconnect()
        NoClipConnection = nil
    end
    
    -- Remove visual effect
    local effect = Character:FindFirstChild("NoClipEffect")
    if effect then
        effect:Destroy()
    end
    
    -- Reset collision
    if Character and Character.Parent then
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                if part.Name == "HumanoidRootPart" then
                    part.CanCollide = false -- HumanoidRootPart should stay non-collidable
                else
                    part.CanCollide = true -- Reset all other parts to normal collision
                end
            end
        end
    end
    
    -- Reset transparency
    for _, part in pairs(Character:GetDescendants()) do
        if part:IsA("BasePart") then
            -- Attempt to restore original transparency
            local originalTransparency = 0
            if part.Name == "Head" then 
                originalTransparency = 0
            elseif part.Name:find("Torso") then
                originalTransparency = 0
            elseif part.Name:find("Arm") then
                originalTransparency = 0
            elseif part.Name:find("Leg") then
                originalTransparency = 0
            elseif part.Name:find("Hand") then
                originalTransparency = 0
            elseif part.Name:find("Foot") then
                originalTransparency = 0
            end
            
            part.Transparency = originalTransparency
        end
    end
    
    NoClipEnabled = false
    print("NoClip Disabled - You will now collide with walls normally")
end

-- Toggle NoClip with the Z key
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if not gameProcessedEvent and input.KeyCode == ToggleKey then
        if NoClipEnabled then
            disableNoClip()
        else
            enableNoClip()
        end
    end
end)

-- Handle character respawning
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
    
    -- Reset NoClip state
    if NoClipConnection then
        NoClipConnection:Disconnect()
        NoClipConnection = nil
    end
    
    NoClipEnabled = false
    print("Character respawned - NoClip disabled")
    
    -- If player had NoClip enabled before respawning, re-enable it
    wait(1) -- Wait for character to fully load
    if NoClipEnabled then
        enableNoClip()
    end
end)

print("Player-Only NoClip script loaded! Press Z to toggle NoClip mode")
